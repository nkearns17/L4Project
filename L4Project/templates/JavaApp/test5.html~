<html>

{% extends 'JavaApp/base-bootstrap.html' %}

{% block topbar %}
<h1><center> Fill In The Blanks </center></h1>
{% endblock %}

{% block content %}

<div id="noOfQs" class="ques">{{questions|length}}</div>

<!-- List of java words -->
<div id="wordList">
<label> {{javaWords}} </label>
</div>

<script>
var keywordList = [];
var ansList = [];
var quesList = [];
</script>

<h3><p id="resultArea"></p></h3>

<h3><p id="testArea"></p></h3>

{% for question in questions %}

	<div class="well" class="testing">
		<label>{{question.id}}</label>
		<!-- Questions from database-->
		<label id="{{question.id}}statement">{{question|linebreaks}}</label>
		<!-- input box for answer.-->
		<form>
			Answer: <input type="text" name="answer" id="answerbox{{question.id}}"><br>
			<!-- <input type="button" value="Submit" id="{{question.id}}submit"> -->
			<button class="btn btn-default" id="{{question.id}}submit" type="button">Check answers</button>
		</form>
	</div><br>

	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>

	<script>
	// Get the question from the html 
	var labelText = $("#{{question.id}}statement").text();
	//document.write(labelText+'<br>');
	
	//add all java words to a lsit.
	var jwl = document.getElementById("wordList").textContent;
	var jwords = jwl.split(",");	
	var size = jwords.length;
	//document.write("LIST2: " + jwords + size + "<br>");

	//check which words in the question match the java keyword and add to a list.
	var matches = [];
	for (var i=0; i < size; i++){
		var text = labelText.indexOf(jwords[i].trim());
		if (text != -1){
			matches.push(jwords[i]);
		}
	}
	//document.write(matches + "<br>");

	//Generate random keyword.
	var keyword = matches[Math.floor(Math.random()*matches.length)];
	keywordList.push(keyword);
	//document.write("KeywordList : " + keywordList + "<br>");	

	// replace word for space 
	var rslt = labelText.indexOf(keyword.trim());
	//document.write(keyword.trim() + " " + rslt + "<br>");
	if (rslt != -1){
		labelText = labelText.replace(keyword.trim(), "_______");		
	}
	
	document.getElementById("{{question.id}}statement").innerHTML=labelText;
	quesList.push(labelText);

	$(document).ready(function() {
		$('#{{question.id}}submit').click(function(){
			var answer = "";
			var textbox = document.getElementById('answerbox{{question.id}}');
			answer = textbox.value;
			ansList.push(answer);
			//for (var j = 0; j < keywordList.length; j++){
			if (answer === keywordList[currentQuestion].trim()){
				//alert(answer + " " + keywordList[currentQuestion].trim());
				$('#{{question.id}}submit').css("background-color","lime");
				//document.getElementById("resultArea").innerHTML=result;
			}
			else{
				$('#{{question.id}}submit').css("background-color","red");
			}
			//}
		});
	});
	</script>


{% endfor %}


<!-- Previous and Next buttons to nav between questions
<button type="button" id='prev' class="btn btn-default btn-lg">
  <span class="glyphicon glyphicon-circle-arrow-left"></span> Previous
</button>

<button type="button" id='next' class="btn btn-default btn-lg">
  <span class="glyphicon glyphicon-circle-arrow-right"></span> Next
</button> -->

<!-- Previous and Next buttons to nav between questions-->
<input type="button" id='prev' value="Previous">
<input type="button" id='next' value="Next">

<script>

$NoOfQ = $('.ques');
//$NoOfQ.hide();
$quesList = $('#wordList');
$testArea = $('#testArea');
$quesList.hide();
var score = 0;
var totalQuestions = document.getElementById("noOfQs").textContent;
//var totalQuestions = 0;
var currentQuestion = 0;
$questions = $('.well');
$questions.hide();
$($questions.get(currentQuestion)).fadeIn();
var curQues = quesList[currentQuestion];


document.getElementById("testArea").innerHTML=currentQuestion;

// when next button clicked, go to next question.
$('#next').click(function(){
    $($questions.get(currentQuestion)).fadeOut(function(){
        currentQuestion = currentQuestion + 1;
	document.getElementById("testArea").innerHTML=currentQuestion;
        if(currentQuestion == totalQuestions){
                //result();
		$qNoArea.hide();
        }else{
		//alert(currentQuestion);
        	$($questions.get(currentQuestion)).fadeIn();
		questionNumber = questionNumber + 1;
		var qNum = "Question " + questionNumber;
		//document.getElementById("questionNum").innerHTML=qNum;
        }
    });
});


$('#next').click(function(){
	
});

// when previous button clicked, go back a question.
$('#prev').click(function(){
    $($questions.get(currentQuestion)).fadeOut(function(){
        if(currentQuestion > 0){
		currentQuestion = currentQuestion - 1;		
		//questionNumber = questionNumber - 1;
		//var qNum = "Question " + questionNumber;
		//document.getElementById("questionNum").innerHTML=qNum;
		$($questions).fadeIn();
		document.getElementById("testing").innerHTML=curQues;
        }
    });

});

// function to display the results with appropriate message depending on score
//function result(){
//	var total = totalQuestions*10;
//	if ((score/total)*100 <= 50 )
//		var msg = "Looks like you need to revise some more";
//	if ((score/total)*100 >= 51)
//		msg = "Well Done, your on the right track!";
//	if (score == total)
//		msg = "Well Done, full marks!";
//	var res = "Your final score is: " + score + "/" + total + "<br>" + msg;
//	document.getElementById("result").innerHTML=res;
//}


</script>

{% endblock %}

<script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
<script src="../../dist/js/bootstrap.min.js"></script>
<link rel="stylesheet" type="text/css" href="{{STATIC_URL}}bootstrap/css/bootstrap.min.css">
<script type="text/javascript" src="http://code.jquery.com/jquery.min.js"></script>
<script src="http://code.jquery.com/jquery.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}bootstrap/js/bootstrap.min.js"></script>
</html>
